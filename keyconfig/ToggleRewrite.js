window._rwHackerStack = window._rwHackerStack || /\bhackerrank\.com\b|\/posts\/\d+\/comments/;
window._rwGAE = window._rwGAE || /\bappengine\.google\.com\/(css|js)/;
window._rwGoogleDev = window._rwGoogleDev || /\b(cloud|developers)\.google\.com\/_static\//;
window._rwMDN = window._rwMDN || /developer\.cdn\.mozilla\.net\/static\//;
window._rwGoogleIssues = window._rwGoogleIssues || /issuetracker\.google\.com\/.+\.(css|js)?/;
window._rwBlogger = window._rwBlogger || /www\.blogger\.com\/dyn-css\//;
window._rwSpring = window._rwSpring || /spring\.io\/.+\.(js|css)/;
window._rwImgSrch = window._rwImgSrch || /www\.google\.[a-z]*\/async\/imgrc\?/;
window._rwReddit = window._rwReddit || /redditstatic\.com\//;
window._rwMozMedia = window._rwMozMedia || /mozilla\.org\/media\//;

window._rwCSSJSPNG = window._rwCSSJSPNG || /\b(js|css|png)\b/;
window._rwCSSJSIgnore = window._rwCSSJSIgnore || /google\.\w+\/search\?|\/xjs\/_\/js\/|recaptcha\/api2\/webworker\.js/;
window._rwCustomReq = window._rwCustomReq || /\/users\/codeheart\/requests\?/;
window._rwParams = window._rwParams || /\b(date|version|timestamp|buildTime|build-number|build|tseed|ver|cx|_v|_t|v|t|_|r|b|u|q|cb)\b=[-a-z_0-9.:]+&?|\?_?[a-z_0-9]+$/g;

window._search = window._search || {};
window._replace = window._replace || {};

url5r = 'https://assetsv2.fiverrcdn.com/';
window._search[url5r] = window._search[url5r] || [
/\/conversations-\w+\.css/,
/\/conversations-\w+\.js/,
/\/jquery\.uploadifive-\w+\.js/,
/\/application-\w+\.js/,
/\/application-\w+\.css/,
/\/application-deferred-\w+\.css/,
/\/application-dependencies-\w+\.js/,
/\/application-legacy-\w+\.js/,
/\/orders-\w+\.css/,
/\/orders-\w+\.js/,
/\/reconnecting\.websocket-\w+\.js/,
/\/global-gig-listings-\w+\.js/,
/\/global-gig-listings-\w+\.css/,
/\/marketplace-\w+\.css/,
/\/user-dashboard-\w+\.css/,
/\/jquery\.inline-alert-\w+\.js/,
/\/todos-\w+\.js/,
/\/page-filter-actions-\w+\.css/,
/\/react-quick_responses-\w+\.css/,
/\/react-quick_responses-\w+\.js/,
/\/react-attachment_preview-\w+\.css/,
/\/polyfills-\w+\.js/,
/\/instantImpressions-\w+\.js/,
/\/jquery-2.1.4.min-\w+\.js/,
/\/translations.en-\w+\.js/,
/\/emoji-helper-\w+\.js/,
/\/popup-report-message-\w+\.js/,
/\/popup-report-message-\w+\.css/,
/\/footer-\w+\.css/,
/\/help-menu-\w+\.css/,
/\/fHelpMenu-\w+\.js/,
/\/appboy.min-\w+\.css/,
/\/appboy.min-\w+\.js/,
/\/notification-drawer-\w+\.css/,
/\/notification-drawer-\w+\.js/,
/\/appboy-overrides-\w+\.css/,
/\/tab-manager-\w+\.js/,
/\/fiverr-realtime-\w+\.css/,
/\/fRealTime-\w+\.js/,
/\/requests-\w+\.js/,
/\/offers-shared-\w+\.css/,
/\/offers-shared-\w+\.js/,
/\/react-order_notes_show-\w+\.css/,
/\/react-order_notes_show-\w+\.js/,
/\/global-social-sharing-\w+\.js/,
/\/popup-base-\w+\.js/,
/\/global-gig-cards-\w+\.css/,
/\/react-inbox-\w+\.css/,
/\/react-inbox-\w+\.js/,
/\/todos-\w+\.js/,
/\/popup-order-social-share-\w+\.js/,
/\/orders-share-deliveries-\w+\.js/,
/\/manage_gigs-\w+\.js/,
/\/passable-\w+\.js/,
/\/react-seller_profile_form_thin-\w+\.css/,
/\/react-seller_profile_form_thin-\w+\.js/,
/\/users-\w+\.css/,
/\/users-\w+\.js/,
/\/seller-popup-\w+\.css/,
/\/fNow-\w+\.js/,
/\/CountryAutocomplete-\w+\.js/,
/\/phone-verification-\w+\.js/,
/\/templates-popups-\w+\.js/,
/\/convDeprecationEvents-\w+\.js/,
/\/bombaMessage-\w+\.js/
];

urlBb = 'https://d301sr5gafysq2.cloudfront.net/';
window._search[urlBb] = window._search[urlBb] || [
/\/css\/entry\/vendor\.css/,
/\/css\/entry\/app\.css/,
/\/css\/entry\/adg3\.css/,
/\/dist\/webpack\/app\.js/,
/\/dist\/webpack\/vendor\.js/,
/\/dist\/webpack\/sentry\.js/,
/\/dist\/webpack\/early\.js/,
/\/dist\/webpack\/common\.js/,
/\/dist\/webpack\/pullrequests\.js/,
/\/dist\/webpack\/1\.chunk\.js/,
/\/dist\/webpack\/word-diff-worker\.js/,
/\/dist\/webpack\/locales\/en\.js/,
/\/dist\/webpack\/dashboard\.js/,
/\/dist\/webpack\/repo-admin\.js/,
/\/jsi18n\/en\/djangojs\.js/
];

urlPPal = 'https://www.paypalobjects.com/';
window._search[urlPPal] = window._search[urlPPal] || [
/\/web\/res\/\w+\/\w+\/css\/contextualLogin\.css/,
/\/auth\/createchallenge\/\w+\/challenge.js/,
/\/js\/lib\/tealeaf-ul-prod_domcap\.min\.js/,
/\/css\/app\.ltr\.css/,
/\/css\/paypal-sans\.css/,
/\/css\/summary\.ltr\.css/,
/\/js\/apps\/app\.js/,
/\/js\/apps\/3\.3\.js/,
/\/widgets\/ajaxError\.js/,
/\/dust-templates\.js/,
/\/languagepack\.js/,
/\/widgets\/overpanel\.js/,
/\/summary\/inc\/fiModule\/fiList\.js/,
/\/activity\/transactionItemSimple\.js/,
/\/txndetails\/modules\.js/,
/\/txndetails\/inc\/layout\.js/,
/\/css\/wallet\.ltr\.css/,
/\/js\/apps\/1\.1\.js/,
/\/eboxapps\/css\/\w+\//,
/\/eboxapps\/css\/\w+\//,
/\/eboxapps\/css\/\w+\//,
/\/eboxapps\/js\/\w+\//,
/\/css\/app-service-nav\.ltr\.css/,
/\/js\/index\.js/,
];

urlPPAuth = 'https://www.paypal.com/auth/createchallenge/';
window._search[urlPPAuth] = window._search[urlPPAuth] || [/challenge\.js/];

urlTrello = 'https://a.trellocdn.com/';
window._search[urlTrello] = window._search[urlTrello] || [
/\/snowplow\.js/,
/\/quickload\.js/,
/\/ltp\.js/,
/\/locale\.en-US\.js/,
/\/app\.js/,
/\/core\.css/,
/\/images\.css/,
/*
https://trello.com/1/boards/58c182fa6a2274fdeeff4ff3/plugins
https://rules.quantcount.com/rules-p-9tnwrxnK1azF1.js
https://bello.atlassian.io/index.6bd8e18b3a5707deeb51.js
https://cdn.segment.com/analytics.js/v1/8Sa7pJhJNl2oAwmmg0bs5LotU31HtsmE/analytics.min.js
*/
];

urlSlack = 'https://a.slack-edge.com/';
window._search[urlSlack] = window._search[urlSlack] || [
/\/style\/rollup-plastic\.css/,
/\/style\/libs\/lato-2-compressed\.css/,
/\/style\/_helpers\.css/,
/\/style\/signin\.css/,
/\/style\/index\.css/,
/\/style\/sticky_nav\.css/,
/\/style\/footer\.css/,
/\/style\/rollup-client_core\.css/,
/\/style\/rollup-client_primary\.css/,
/\/style\/typography\.css/,
/\/style\/rollup-client_general\.css/,
/\/style\/rollup-client_secondary\.css/,
/\/style\/rollup-client_base\.css/,
/\/style\/date_picker\.css/,
/\/style\/libs\/quill\.core\.css/,
/\/style\/texty\.css/,
/\/style\/rollup-slack_kit_legacy_adapters\.css/,
/\/style\/account_settings\.css/,
/\/bv1-1\/webpack\.manifest\.\w+\.min\.js/,
/\/bv1-1\/emoji\.\w+\.min\.js/,
/\/bv1-1\/rollup-core_required_libs\.\w+\.min\.js/,
/\/bv1-1\/rollup-core_required_ts\.\w+\.min\.js/,
/\/bv1-1\/handlebars_4010\.\w+\.min\.js/,
/\/bv1-1\/TS\.web\.\w+\.min\.js/,
/\/bv1-1\/rollup-core_web\.\w+\.min\.js/,
/\/bv1-1\/rollup-secondary_a_required\.\w+\.min\.js/,
/\/bv1-1\/rollup-secondary_b_required\.\w+\.min\.js/,
/\/bv1-1\/application\.\w+\.min\.js/,
/\/bv1-1\/slack_beacon\.\w+\.min\.js/,
/\/bv1-1\/webpack\.manifest\.\w+\.min\.js/,
/\/bv1-1\/bootstrap-client\.\w+\.min\.js/,
/\/bv1-1\/emoji\.\w+\.min\.js/,
/\/bv1-1\/rollup-core_required_libs\.\w+\.min\.js/,
/\/bv1-1\/rollup-core_required_ts\.\w+\.min\.js/,
/\/bv1-1\/handlebars_4010\.\w+\.min\.js/,
/\/bv1-1\/rollup-client\.\w+\.min\.js/,
/\/bv1-1\/TS\.highlights_briefing\.\w+\.min\.js/,
/\/bv1-1\/TS\.utility\.window\.\w+\.min\.js/,
/\/bv1-1\/TS\.files\.gdrive\.\w+\.min\.js/,
/\/bv1-1\/TS\.files\.onedrive\.\w+\.min\.js/,
/\/bv1-1\/TS\.ui\.current_status_input\.\w+\.min\.js/,
/\/bv1-1\/rollup-secondary_a_required\.\w+\.min\.js/,
/\/bv1-1\/rollup-secondary_b_required\.\w+\.min\.js/,
/\/bv1-1\/application\.\w+\.min\.js/,
/\/bv1-1\/focus-ring\.\w+\.min\.js/,
/\/bv1-1\/lz-string-[\d.]+\.worker\.\w{20,}\.js/,
/\/bv1-1\/TS\.client\.ui\.channel_insights\.\w+\.min\.js/,
/\/bv1-1\/TS\.web\.account_settings\.\w+\.min\.js/,
/\/bv1-1\/username_format\.\w+\.min\.js/,
/\/bv1-1\/zxcvbn\.\w+\.min\.js/,
/\/bv1-1\/format-message-parse-tokens\.\w+\.min\.js/,
/\/bv1-1\/message-format\.\w+\.min\.js/,
/\/bv1-1\/TS\.min\.\w+\.min\.js/,
/\/bv1-1\/TS\.i18n\.\w+\.min\.js/,
/\/bv1-1\/TS\.clog\.\w+\.min\.js/,
/\/bv1-1\/signals\.\w+\.min\.js/,
/\/bv1-1\/sticky_nav\.\w+\.min\.js/,
/\/bv1-1\/spin\.\w+\.min\.js/,
/\/bv1-1\/ladda\.\w+\.min\.js/,
/\/bv1-1\/footer\.\w+\.min\.js/,
/\/bv1-1\/jquery\.\w+\.min\.js/,
/\/bv1-1\/Intl\.\w+\.min\.js/,
/\/bv1-1\/warn_capslock\.\w+\.min\.js/,
/\/bv1-1\/modern\.vendor\.\w+\.min\.js/,
/\/bv1-1\/codemirror\.min\.\w+\.min\.js/,
/\/bv1-1\/simple\.\w+\.min\.js/,
/\/bv1-1\/codemirror_load\.\w+\.min\.js/,
];

urlSlackTmpl = ".slack.com/templates.php?cb=";
_search[urlSlackTmpl] = _search[urlSlackTmpl] || [/templates\.php\?cb=/];

urleBayDev = '://ir.ebaystatic.com/rs/c/';
window._search[urleBayDev] = window._search[urleBayDev] || [
[/hello-\w+\.css/, 2],
[/reset-\w+\.css/, 2],
[/fyp-\w+\.css/, 2],
[/auth-\w+\.css/, 2],
[/keys-\w+\.css/, 2],
[/profile-\w+\.css/, 2],
/hello-\w+\.js/,
/reset-\w+\.js/,
/fyp-\w+\.js/,
/auth-\w+\.js/,
/keys-\w+\.js/,
/profile-\w+\.js/,
];

urleBay = 'https://secureir.ebaystatic.com/rs/v/';
window._search[urleBay] = window._search[urleBay] || [
[/\w+\.css/, 5],
[/\w+\.js/, 7],
];

urlEBForum = '://forums.developer.ebay.com/';
window._search[urlEBForum] = window._search[urlEBForum] || [/\/css\/bootstrap\.min\.css/];

urlGH = 'https://assets-cdn.github.com/assets/';
window._search[urlGH] = window._search[urlGH] || [
/mobile-\w+\.css/,
/mobile-\w+\.js/,
/frameworks-\w+\.css/,
/frameworks-\w+\.js/,
/github-\w+\.css/,
/github-\w+\.js/,
/compat-\w+\.js/,
];

urlDZ1 = '://dz2cdn3.dzone.com/';
window._search[urlDZ1] = window._search[urlDZ1] || [[/-combined\.css/, 2]];
urlDZ2 = '://dz2cdn2.dzone.com/';
window._search[urlDZ2] = window._search[urlDZ2] || [[/-combined\.js/, 2]];

urlGAS = 'https://script.google.com/';
window._search[urlGAS] = window._search[urlGAS] || [
/\/client\/css\/\d+-MaestroIdeShellCss_ltr.css/,
/\/client\/js\/\d+-code_mirror_bin_code_mirror.js/,
/\/client\/js\/\d+-maestro_ide_shell_bin_i18n_maestro_ide_shell\.js/,
/\/gwt\/googleappsscripts\.nocache\.js/,
/\/sharing\/init/,
/\/gwt\/\w+\.cache\.js/,
/\/static\/\d+-Browser/,
/\/static\/\d+-CacheService/,
/\/static\/\d+-CalendarApp/,
/\/static\/\d+-Charts/,
/\/static\/\d+-GmailApp/,
/\/static\/\d+-ContactsApp/,
/\/static\/\d+-ContentService/,
/\/static\/\d+-DocumentApp/,
/\/static\/\d+-DriveApp/,
/\/static\/\d+-FormApp/,
/\/static\/\d+-PropertiesService/,
/\/static\/\d+-GroupsApp/,
/\/static\/\d+-ScriptApp/,
/\/static\/\d+-ScriptProperties/,
/\/static\/\d+-Session/,
/\/static\/\d+-SpreadsheetApp/,
/\/static\/\d+-UiApp/,
/\/static\/\d+-UrlFetchApp/,
/\/static\/\d+-UserProperties/,
/\/static\/\d+-Utilities/,
/\/static\/\d+-XmlService/,
/\/static\/\d+-Blob/,
/\/static\/\d+-HtmlService/,
/\/static\/\d+-Jdbc/,
/\/static\/\d+-LanguageApp/,
/\/static\/\d+-LinearOptimizationService/,
/\/static\/\d+-Ui/,
/\/static\/\d+-LockService/,
/\/static\/\d+-Logger/,
/\/static\/\d+-MailApp/,
/\/static\/\d+-Maps/,
/\/static\/\d+-MimeType/,
/\/static\/\d+-SlidesApp/,
/\/static\/\d+-console/,
/\/static\/\d+-BigNumber/,
/\/static\/\d+-JSON/,
/\/static\/\d+-Math/,
/\/static\/\d+-Object/,
/\/static\/\d+-BlobSource/,
/\/static\/\d+-Button/,
/\/static\/\d+-ButtonSet/,
/\/static\/\d+-ColumnType/,
/\/static\/\d+-DataTable/,
/\/static\/\d+-DataTableBuilder/,
/\/static\/\d+-DataTableSource/,
/\/static\/\d+-DigestAlgorithm/,
/\/static\/\d+-Menu/,
/\/static\/\d+-Month/,
/\/static\/\d+-PromptResponse/,
/\/static\/\d+-User/,
/\/static\/\d+-Weekday/,
/\/static\/\d+-Array/,
/\/static\/\d+-SitesApp/,
/\/static\/\d+-CardService/,
];

urlGooJS = 'https://www.google.com/js/';
window._search[urlGooJS] = window._search[urlGooJS] || [
[/\/bg\/\w+\.js/, 2],
];

urlGAPI = 'https://apis.google.com/_/scs/abc-static/';
window._search[urlGAPI] = window._search[urlGAPI] || [
[/_\/js\/k=gapi\.gapi\.en\..*\/m=gapi_iframes,googleapis_client,plusone\/rt=j\/sv=1\/d=1\/ed=1\/rs=.*\/cb=gapi\.loaded_0/, 2],
/_\/js\/k=gapi\.gapi\.en\..*\/m=gapi_iframes,googleapis_client,iframes_styles_slide_menu,plusone\/rt=j\/sv=1\/d=1\/ed=1\/rs=.*\/cb=gapi\.loaded_0/,
];

urlMozBug = 'https://bugzilla.mozilla.org/data/assets/';
window._search[urlMozBug] = window._search[urlMozBug] || [
[/\w+\.css/, 2],
[/\w+\.js/, 4],
];

urlOstk = 'https://ak1.ostkcdn.com/';
window._search[urlOstk] = window._search[urlOstk] || [
/js\/product-page\.[.\d]+\.min\.js/,
/css\/os-master\.[.\d]+\.min\.css/,
/js\/overstock\.[.\d]+\.min\.js/,
/js\/os-async\.[.\d]+\.min\.js/,
/js\/ostk-user-tracking-all\.[.\d]+\.min\.js/,
/js\/thirdparty\/siteIntercept\.[.\d]+\.min\.js/,
/js\/thirdparty\/ensighten\/ensighten-bootstrap\.js/,
/js\/thirdparty\/swf\/jwplayer\.[.\d]+\.min\.js/,
/js\/s_code_async\.js/,
/css\/product-page\.[.\d]+\.min\.css/,
/js\/os-templates\.[.\d]+\.min\.js/,
];

urlMedium = 'https://cdn-static-1.medium.com/_/fp/';
window._search[urlMedium] = window._search[urlMedium] || [
/gen-js\/main-base\.bundle\..+\.js/,
/gen-js\/main-common-async\.bundle\..+\.js/,
/gen-js\/main-misc-screens\.bundle\..+\.js/,
/gen-js\/main-notes.bundle\..+\.js/,
/gen-js\/main-home-screens\.bundle\..+\.js/,
/gen-js\/main-posters\.bundle\..+\.js/,
/css\/main-branding-base\..+\.css/,
/css\/fonts-latin-base\..+\.css/,
/css\/fonts-base\..+\.css/,
];

urlStatCtr = 'https://statcounter.com/';
window._search[urlStatCtr] = window._search[urlStatCtr] || [
/\/css\/packed\/app-\w+\.css/,
/\/css\/packed\/print-\w+\.css/,
/\/js\/packed\/user-\w+\.js/,
/\/js\/packed\/base-\w+\.js/,
/\/css\/packed\/layout-\w+\.css/,
];

urlDkrHubId = "https://id.docker.com/static/";
window._search[urlDkrHubId] = window._search[urlDkrHubId] || [
/vendor\.\w+\.css/,
/login\.\w+\.css/,
/vendor\.\w+\.js/,
/login\.\w+\.js/,
];

urlDkrHub = "https://hub.docker.com/";
window._search[urlDkrHub] = window._search[urlDkrHub] || [
/vendor\.\w+\.css/,
/login\.\w+\.css/,
/vendor\.\w+\.js/,
/login\.\w+\.js/,
/client\.\w+\.js/,
/main-0-\w+\.css/,
];

urlK8sIo = "https://d33wubrfki0l68.cloudfront.net/";
window._search[urlK8sIo] = window._search[urlK8sIo] || [
/\w+\/css\/styles\.css/,
];

urlEc2 = "/ec2/";
window._search[urlEc2] = window._search[urlEc2] || [
/ec2\.nocache\.js/,
/[^\/]{5,}\.cache\.js/,
/\/1\.cache\.js/,
/\/2\.cache\.js/,
/\/3\.cache\.js/,
/\/4\.cache\.js/,
/\/5\.cache\.js/,
/\/6\.cache\.js/,
/\/7\.cache\.js/,
/\/8\.cache\.js/,
/\/9\.cache\.js/,
/\/10\.cache\.js/,
/\/11\.cache\.js/,
/\/12\.cache\.js/,
/\/13\.cache\.js/,
/\/14\.cache\.js/,
];

urlEc22 = ".gz.";
window._search[urlEc22] = window._search[urlEc22] || [
/menu-\w+\/globalnav-\w+\.gz\.css/,
/mezz-\w+\/custsat-\w+\.gz\.css/,
/mezz-\w+\/custsat-\w+\.gz\.js/,
[/mezz-\w+\/mezz-\w+.gz.js/, 2],
/menu-\w+\/globalnav-\w+\.gz\.js/,
/iam\/assets\/css\/bundles\/1_1505433600_270085c48f576fdeb829590f4fc80996\.css\.gz\.css/,
/iam\/assets\/js\/bundles\/en_4_1505433600_185326f6f405fe93a05e1f0cfd76ac88\.min\.js\.gz\.js/,
];

urlEc23 = ".cloudfront.net/";
window._search[urlEc23] = window._search[urlEc23] || [
/versions\/live-ec2\/[\w-_]+\/Content\/text\/content_en\.js/,
/\/amznUrchin\.js/,
/iam\/assets\/js\/bundles\/policies.js/,
];

urlGeeks = "codegeeks.com/wp-content/cache/autoptimize/";
window._search[urlGeeks] = window._search[urlGeeks] || [
[/css\/autoptimize_\w+\.css/, 3],
/js\/autoptimize_\w+\.js/
];

window._sanitizeUrl = window._sanitizeUrl || function(url, params) {
	if (!params) {
		params = url.match(_rwParams) || [];
	}
	params.map(function(v) {
		url = url.replace(v, '');
	});
	return url.endsWith('?') ? url.substring(0, url.length - 1) : url;
};

window._redir = window._redir || function(channel, url) {
	origUrl = channel.URI;
	if (origUrl.spec === url)	// already redirected
		return;
	channel.redirectTo(origUrl.mutate().setSpec(url).finalize());
};

window.toggleRW = window.toggleRW || function() {
	toggleService.toggle('rw', function(channel) {
		url = channel.URI.spec;
		//console.debug(url, "start");
		if (url.match(_toggleIgnore)) {
			//console.debug(url, "ignored");
			return;
		}
		if(url.match(_rwHackerStack))
			_redir(channel, url.replace(/&?_=\d+/, '').replace(/\?$/, ''));
		else if(url.match(_rwGAE))
			_redir(channel, url.replace(/\d+\-[0-9a-z]+\.\d+\./, ''));
		else if(url.match(_rwGoogleDev)) {
			pos = url.indexOf("/", url.indexOf("_static"));
			_redir(channel, url.substring(0, pos) + url.substring(url.indexOf("/", pos + 1)));
		}
		else if(url.match(_rwMDN))
			_redir(channel, url.replace(/[0-9a-z]+\.js/, 'js').replace(/[0-9a-z]+\.css/, 'css'));
		else if(url.match(_rwGoogleIssues))
			_redir(channel, url.substring(0, url.lastIndexOf('?')));
		else if(url.match(_rwBlogger))
			_redir(channel, url.substring(0, url.indexOf("?")));
		else if(url.match(_rwSpring))
			_redir(channel, url.replace(/-[a-z0-9]{32}\./, '.'));
		else if(url.match(_rwImgSrch)) {
			csi = url.indexOf('&csi=');
			_redir(channel, (url.substring(0, csi) + url.substring(url.indexOf('&', csi + 1))).replace(/cidx:\d,_id:irc_imgrc\d,_pms:s/, "cidx:2,_id:irc_imgrc2,_pms:s"));
		}
		else if(url.match(_rwReddit))
			_redir(channel, url.replace(/\.\S{11}\./, '.'));
		else if(url.match(_rwMozMedia))
			_redir(channel, url.replace(/\.\S{12}\./, '.'));

		else for(k in _search) if(url.indexOf(k) > -1) {
			s = _search[k];
			r = _replace[k] || (_replace[k] = []);
			for(i in s) {
				multi = s[i] instanceof Array;
				key = multi ? s[i][0] : s[i];
				if(url.match(key)) {
					if(r[i]) {
						if (!multi) {
							if (!rwOverwriteDown) {
								r[i] = _sanitizeUrl(channel.URI.spec);
							}
							_redir(channel, r[i]);
							//console.debug(url, "->", channel.URI.spec);
							return;
						}
						s[i][2] = (++s[i][2] || 0) % s[i][1];
						if (r[i][s[i][2]]) {
							if (!rwOverwriteDown) {
								r[i][s[i][2]] = _sanitizeUrl(channel.URI.spec);
							}
							_redir(channel, r[i][s[i][2]]);
							//console.debug(url, "->", channel.URI.spec);
						} else {
							r[i].push(_sanitizeUrl(url));
						}
					} else {
						url = _sanitizeUrl(url);
						r[i] = multi ? [url] : url;
					}
					return;
				}
			}
			return;
		}

		//skip sanitization unless a custom request OR a CSS/JS/PNG that's not in the ignore list
		if((!url.match(_rwCSSJSPNG) || url.match(_rwCSSJSIgnore)) && !url.match(_rwCustomReq)) {
			//console.debug(url, "final", channel.URI.spec)
			return;
		}

		params = url.match(_rwParams);
		if(!params) {
			//console.debug(url, "no params; final", channel.URI.spec)
			return;
		}
		_redir(channel, _sanitizeUrl(url, params));
		//console.debug(url, "final", channel.URI.spec)

	}, {
		title: "URL Rewriter On",
		body: "Chosen URLs will be remapped to cache."
	}, {
		title: "URL Rewriter Off",
		body: "Chosen URLs will load normally."
	});
};
toggleRW();
